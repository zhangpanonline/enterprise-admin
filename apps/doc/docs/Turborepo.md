---
sidebar_position: 1
title: Turborepo
---


## 1. Turborepo 介绍

### 1.1 Turborepo 是什么

`Turborepo` 是一个为 `JavaScript` 和 `TypeScript` 代码库设计的高性能构建系统，特别针对 `monorepo`（单一仓库）架构优化，同时也适用于单包工作区。它由 `Vercel` 开发，旨在通过 **智能任务调度** 和 **缓存机制** 加速开发流程，减少构建、测试和 linting 等任务的执行时间。Turborepo 支持常见的包管理器（如 npm、yarn、pnpm），并通过简单的配置文件（turbo.json）集成到现有工作流中。

### 1.2 Monorepo 是什么

`Monorepo`（单一仓库）是一种代码管理策略，将多个相关项目或包存储在一个单一的 `Git` 仓库中，而不是为每个项目创建单独的仓库。例如，一个 `monorepo` 可能包含前端应用、后端服务和共享库，统一管理它们的代码、依赖和构建流程。

优点：
* 统一依赖管理，减少版本冲突，例如在 `pnpm-workspace.yaml` 里统一配置依赖版本，各个项目用时使用 `workspace:*` 引入依赖。
* 跨项目代码共享更简单。
* 统一的工具链和 CI/CD 配置。


### 1.3 Monorepo 存在什么问题

`Monorepo` 在规模化时会遇到以下挑战：
1. 构建时间长：随着包数量增加，运行测试、linting 或构建任务的时间显著增长。例如，文档提到任务执行时间可能从 90 秒增加到 140 秒。
2. 重复计算：在 `CI/CD` 流水线中，相同的任务（如测试或构建）可能在每次提交时重复运行，浪费计算资源。
3. 复杂任务依赖：多个包之间的依赖关系导致任务顺序复杂，难以高效调度。
4. 开发反馈慢：开发者运行命令后需等待较长时间，降低开发效率。

这些问题尤其在大型团队或复杂项目中显著，影响开发速度和成本。

### 1.4 Turborepo 如何解决 Monorepo 的这些问题

`Turborepo` 针对上述问题提供了以下解决方案：
1. 加速构建时间：通过并行任务调度和缓存机制，大幅缩短构建、测试和 linting 的执行时间。
2. 消除重复计算：利用远程缓存`（Remote Cache）`，避免重复执行相同的任务。
3. 优化任务依赖管理：自动分析包之间的依赖关系，智能调度任务执行顺序。
4. 提升开发体验：快速反馈循环，让开发者能更快验证代码变更。

总结：  
> `Turborepo` 是一个强大的 `monorepo` 构建工具，解决了 `monorepo` 规模化带来的构建慢、重复计算和任务管理复杂的问题。它通过远程缓存、并行任务调度和增量执行等机制，显著提升开发效率和 `CI/CD` 性能。


## 2. Turborepo 的特点

### 2.1 远程缓存（Remote Cache）
* **描述**：将任务输出（如构建结果、测试结果）存储在本地或远程缓存中，如果任务的输入（如代码或依赖）未发生变化，`Turborepo` 会直接复用缓存结果，而非重新运行。
* **优势**：显著减少 `CI/CD` 流水线和本地开发中的任务执行时间。例如，文档提到带缓存的任务可在 80 毫秒内完成，而无缓存可能需数秒。
* **实现**：支持 `Vercel` 提供的远程缓存服务（需配置）或本地缓存。

### 2.2 智能任务调度（Task Scheduling）
* **描述**：利用所有可用 `CPU` 核心并行执行独立任务，同时根据包的依赖图`（dependency graph）`优化任务执行顺序。
* **优势**：加速构建、测试和 linting 等任务，尤其在多包 `monorepo` 中效果显著，提供更快的开发者反馈循环。
* **实现**：通过 `turbo.json` 文件定义任务管道（如 `build、test、lint`），自动管理依赖和并行化。

### 2.3 增量执行（Incremental Execution）
* **描述**：仅运行受代码或依赖变更影响的任务，其他未受影响的任务直接跳过或使用缓存。
* **优势**：避免不必要的计算，节省时间，尤其在大型 monorepo 中效果明显。

### 2.4 易于集成
* **描述**：无需大幅修改现有项目，仅需添加 `turbo.json` 配置文件并运行 `turbo run <task>` 命令（如 `turbo run build`）。
* **优势**：无缝适配现有工作流，支持 `npm、yarn 和 pnpm` 等包管理器，降低学习和迁移成本。

### 2.5 支持 Monorepo 和单包工作区
* **描述**：专为 `monorepo` 设计，但也适用于单包项目，灵活应对不同规模的代码库。
* **优势**：无论项目规模如何，均可通过缓存和调度优化性能。


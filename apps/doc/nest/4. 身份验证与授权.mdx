---
sidebar_position: 4
title: 4. 身份验证与授权
---
# 身份验证与授权
在应用程序中，身份验证是验证用户身份的过程，而授权是确定用户是否有权限执行特定操作的过程。

## 一、Cookie、Session、Token、JWT、SSO 详解

### 1.1 什么是身份验证

身份验证的通俗解释就是确认当前用户确实是其自称的那个人。

常见的身份验证方式有以下几种：

* 账号密码登录验证
* 手机短信验证
* 邮箱验证码验证
* 人脸识别验证
* 指纹登录验证

### 1.2 什么是授权

用户授予第三方应用访问某些资源的权限，称为授权。例如微信小程序询问是否允许访问昵称、微信名称等个人信息。

### 1.3 什么是凭证

实现身份验证和授权的前提是需要一种媒介来标识访问者的身份。当用户登录某个网站时，服务器会返回一个 `SessionID`（会话ID）或 `Token`（令牌）到用户浏览器中，用于标识当前用户的身份。再次请求访问网站时带上这个凭证，服务器才能识别出该用户的身份，并授予相应的操作权限。

### 1.4 什么是 Cookie

HTTP 协议是一种无状态协议，服务端在每次请求中无法识别请求是由哪个用户发起的。为了解决这个问题，需要一种机制来存储用户的身份信息，在后续请求时提供给服务器来识别是否为同一用户。这就需要用到 Cookie 了。

Cookie 存储在客户端浏览器中，由服务器发送并以文本文件形式存在，其大小通常限制在 4KB 以内。当用户再次向同一服务器发起请求时，Cookie 会被自动包含在请求头中并发送至服务器。需要注意的是，Cookie 不支持跨域访问，即每个 Cookie 都与特定域名绑定，无法被其他域名下的页面访问，但在相同域名下的页面直接可以共享使用。

由于 Cookie 存储在客户端，用户可以地查看和修改这些信息，这可能导致用户信息泄露，带来安全隐患。为了解决这一问题，通常会采用结合使用 Session 和 Cookie 的方法。在这种方法中，用户的敏感信息存储在服务端的 Session 中，而 Cookie 仅存储 Session 的标识符。这样，即使客户端的 Cookie 被访问，攻击者也无法直接获取到敏感的用户信息。

### 1.5 什么是 Session

Session 是另一种维持服务端与客户端的会话状态的机制，通常基于 Cookie 实现。Session 存储在服务端中，而 SessionID 存储在客户端的 Cookie 字段中。

### 1.6 Session 与 Cookie 的区别

Session 与 Cookie 在 Web 程序中的不同用途和实现方式决定了它们之间存在以下区别：

* 存储位置：Cookie 通常以文本形式存储在客户端浏览器中，而 Session 数据则存储在服务端，可能是数据库或内存中，可以以任意类型存在。
* 安全性：由于 Cookie 存储在客户端，因此可以被用户查看和修改，存在安全风险。相比之下，Session 数据存储在服务端，用户无法直接访问和修改，因此相对更安全，不过，Session 仍可能面临 CSRF（Cross-Site Request Forgery，跨站请求伪造）攻击的风险，这种攻击经常通过钓鱼网站进行。
* 生命周期：Cookie 可以设置一个较长的有效期，实现如默认登录等功能，而 Session 的生命周期通常较短，会在客户端关闭或 Session 超时后失效（默认情况下）。
* 存储大小：单个 Cookie 的数据存储大小通常限制在 4KB 以内，而 Session 所能存储的数据量远大于 Cookie，没有 4KB 的限制。

结合使用 Session 和 Cookie 的方案相较于仅使用 Cookie 具有明显优势，但它并非没有缺陷。除了容易受到 CSRF（跨站请求伪造）攻击之外，Session 由于存储在服务端，还面临一些挑战。特别是在多服务器环境中，当出现高并发时，用户的请求可能会被负载均衡器分配到不同的服务器上。如果用户的 Session 信息仅保存在一台服务器上，那么其他服务器将无法访问该 Session 信息，从而导致会话管理问题。

为了解决这一问题，通常需要采用特殊的方案在多台服务器之间同步 Session 信息。一种常见的做法是使用像 Redis 这样的分布式缓存系统来存储 Session 数据，以确保所有服务器都能访问到最新的用户会话状态。

除了 Session 和 Cookie 的结合使用，我们还可以考虑使用 Token（如 JWT）来实现服务端的无状态化。无状态化意味着用户的会话信息被编码在 Token 中，每次请求时由客户端发送，服务端通过解析 Token 来验证用户身份，无须在服务端存储 Session 信息。

### 1.7 什么是 Token

Token 是访问受限资源时需要携带的一种凭证，通常是一个加密字符串，常见的 Token 有以下两种。

#### 1.7.1 访问令牌

访问令牌（Access Token）是一种用于授权用户访问特定资源或执行特定操作的凭证。

```sequence
对象A -> 对象: 32
```



#### 1.7.2 刷新令牌

### 1.8 什么是 JWT

### 1.9 JWT 和 Token 的区别

### 1.10 什么是 SSO

## 二、基于 Passport 和 JWT 实现身份验证

## 三、基于 RBAC 实现权限控制